<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Assistant - Admin Panel</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <script>
        // Always set admin as admin@medicalassistant.com
        localStorage.setItem('adminEmail', 'admin@medicalassistant.com');
        localStorage.setItem('adminName', 'Admin');
    </script>

    <div class="container admin-container-root">
        <header class="admin-header">
            <h1>Admin Panel</h1>
            <div class="admin-info">
                <span id="adminName">Admin</span>
                <button onclick="logout()" class="btn-secondary">Logout</button>
            </div>
        </header>

        <main class="admin-container">
            <div class="admin-sidebar">
                <nav class="admin-nav">
                    <button class="nav-btn active" data-section="dashboard">Dashboard</button>
                    <button class="nav-btn" data-section="users">Users</button>
                    <button class="nav-btn" data-section="chats">Chat History</button>
                    <button class="nav-btn" data-section="settings">Settings</button>
                </nav>
            </div>

            <div class="admin-content">
                <!-- Dashboard Section -->
                <section id="dashboard" class="admin-section active">
                    <h2>Dashboard</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total Users</h3>
                            <p id="totalUsers">0</p>
                        </div>
                        <div class="stat-card">
                            <h3>Active Chats</h3>
                            <p id="activeChats">0</p>
                        </div>
                        <div class="stat-card">
                            <h3>Total Messages</h3>
                            <p id="totalMessages">0</p>
                        </div>
                    </div>
                </section>

                <!-- Users Section -->
                <section id="users" class="admin-section">
                    <h2>User Management</h2>
                    <div class="search-bar">
                        <input type="text" id="userSearch" placeholder="Search users...">
                    </div>
                    <div class="users-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Chat History Section -->
                <section id="chats" class="admin-section">
                    <h2>Chat History</h2>
                    <div class="chat-filters">
                        <select id="userFilter">
                            <option value="">All Users</option>
                        </select>
                        <input type="date" id="dateFilter">
                        <button id="clearHist" class="btn-secondary">Clear History</button>
                    </div>
                    <div class="chat-history" id="chatHistory">
                        <!-- Chat history will be populated here -->
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="settings" class="admin-section">
                    <h2>Settings</h2>
                    <form id="settingsForm">
                        <div class="form-group">
                            <label for="apiKey">DeepSeek API Key</label>
                            <input type="password" id="apiKey" placeholder="Enter API Key">
                        </div>
                        <div class="form-group">
                            <label for="modelSelect">AI Model</label>
                            <select id="modelSelect">
                                <option value="deepseek-v3">DeepSeek V3</option>
                            </select>
                        </div>
                        <button type="submit" class="btn-primary">Save Settings</button>
                    </form>
                </section>
            </div>
        </main>
    </div>

    <script>
        // Populate dashboard stats
        function renderDashboardStats() {
            // Only John Doe is a user
            document.getElementById('totalUsers').textContent = '1';
            const history = JSON.parse(localStorage.getItem('chatHistory') || '[]');
            const johnDoeActive = localStorage.getItem('johnDoeActive') === 'true';
            // Active chats: 1 if John Doe is active and there is any chat history, else 0
            document.getElementById('activeChats').textContent = (johnDoeActive && history.length > 0) ? '1' : '0';
            // Total messages: number of messages in chatHistory
            document.getElementById('totalMessages').textContent = history.length;
        }

        // Populate users table
        function renderUsersTable() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            const johnDoeActive = localStorage.getItem('johnDoeActive') === 'true';
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>John Doe</td>
                <td>john.doe@example.com</td>
                <td><span style="color:${johnDoeActive ? 'green' : 'gray'};font-weight:bold;">${johnDoeActive ? 'active' : 'offline'}</span></td>
                <td>-</td>
            `;
            tbody.appendChild(tr);
        }

        // Populate chat history on page load
        function renderChatHistory() {
            const chatHistoryDiv = document.getElementById('chatHistory');
            chatHistoryDiv.innerHTML = '';
            const history = JSON.parse(localStorage.getItem('chatHistory') || '[]');
            if (history.length === 0) {
                chatHistoryDiv.innerHTML = '<div>No chat history found.</div>';
                return;
            }
            history.forEach(msg => {
                const msgDiv = document.createElement('div');
                msgDiv.className = 'message ' + msg.role;
                msgDiv.innerHTML = `<strong>${msg.user}:</strong> ${msg.text} <span style='color:#888;font-size:12px;float:right;'>${new Date(msg.timestamp).toLocaleString()}</span>`;
                chatHistoryDiv.appendChild(msgDiv);
            });
        }

        // Navigation functionality
        document.querySelectorAll('.nav-btn').forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons and sections
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.admin-section').forEach(section => section.classList.remove('active'));
                // Add active class to clicked button and corresponding section
                button.classList.add('active');
                const sectionId = button.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
                // If switching to dashboard, users, or chats, re-render
                if (sectionId === 'dashboard') renderDashboardStats();
                if (sectionId === 'users') renderUsersTable();
                if (sectionId === 'chats') renderChatHistory();
            });
        });

        // Initial render for dashboard, users, and chat history
        renderDashboardStats();
        renderUsersTable();
        renderChatHistory();

        function logout() {
            localStorage.removeItem('isAdmin');
            localStorage.removeItem('adminEmail');
            window.location.href = 'admin-login.html';
        }
    </script>
</body>
</html> 